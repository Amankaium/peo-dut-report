from django.views import View
from django.http import HttpResponse
import requests
from time import sleep


class KTGParserView(View):
    def get(self, request):
        context = {}
        sid = "714780b4daa79f1bfb89c0787dd3c057"
        url_params = f"https://wialon.realcom.kg/wialon/ajax.html?svc=report/exec_report&sid={sid}"
        params = '{"reportResourceId":6354,"reportTemplateId":2,"reportTemplate":null,"reportObjectId":6764,"reportObjectSecId":0,"interval":{"flags":16777216,"from":1720375200,"to":1720461599},"remoteExec":1,"reportObjectIdList":[]}'

        result_url = f'https://wialon.realcom.kg/wialon/ajax.html?svc=report/select_result_rows&sid={sid}'
        result_params = '{"tableIndex":0,"config":{"type":"range","data":{"from":0,"to":49,"level":0,"unitInfo":1}}}'

        response = requests.post(
            url=url_params,
            data={
                "sid": sid,
                "params": params,
            }
        )
        # print(response.json())
        print(response.status_code)
        # return HttpResponse(response)

        for i in range(5):
            sleep(0.5)
            status_url = f'https://wialon.realcom.kg/wialon/ajax.html?svc=report/get_report_status&sid={sid}'
            response = requests.post(
                url=status_url,
                data={
                    "sid": sid,
                    "params": '{}',
                }
            )
            print(response.status_code, response.json())

        response = requests.post(
            url=result_url,
            data={
                "sid": sid,
                "params": result_params,
            }
        )
        data = response.json()

        return HttpResponse(data)


a = {'n': 0, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6648,
     'c': ['1', 'Actros 4682 BC', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 1, 'i1': 0, 'i2': 2030, 't1': 1720375406, 't2': 1720461500, 'd': 1, 'uid': 6605,
 'c': ['2', 'Axor 01KG 093AJ', '266.34 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 2, 'i1': 0, 'i2': 286, 't1': 1720375414, 't2': 1720461366, 'd': 1, 'uid': 6610,
 'c': ['3', 'Axor 01KG 094AJ', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 3, 'i1': 0, 'i2': 287, 't1': 1720375237, 't2': 1720461488, 'd': 1, 'uid': 6606,
 'c': ['4', 'Axor 01KG 095AJ', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '229.56 л', '252.80 л']}
{'n': 4, 'i1': 0, 'i2': 342, 't1': 1720375273, 't2': 1720461552, 'd': 1, 'uid': 6617,
 'c': ['5', 'Axor 01KG 096AJ', '0.31 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 5, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6602,
 'c': ['6', 'Axor 01KG 097AJ', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 6, 'i1': 0, 'i2': 1445, 't1': 1720375313, 't2': 1720461528, 'd': 1, 'uid': 6618,
 'c': ['7', 'Axor 01KG 283AG', '91.35 км', '50.90 л', '48.29 л', '55.67 л/100 км', '52.82 л/100 км', '0.00 л',
       '0.00 л']}
{'n': 7, 'i1': 0, 'i2': 497, 't1': 1720405636, 't2': 1720435646, 'd': 1, 'uid': 6600,
 'c': ['8', 'Axor 01KG 284AG', '86.94 км', '0.00 л', '29.97 л', '0.00 л/100 км', '34.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 8, 'i1': 0, 'i2': 286, 't1': 1720375438, 't2': 1720461392, 'd': 1, 'uid': 6609,
 'c': ['9', 'Axor 01KG 285AG', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 9, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6666,
 'c': ['10', 'Axor 01KG 286AG', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 10, 'i1': 0, 'i2': 583, 't1': 1720394867, 't2': 1720459506, 'd': 1, 'uid': 6601,
 'c': ['11', 'Axor 01KG 287AG', '39.29 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 11, 'i1': 0, 'i2': 433, 't1': 1720415103, 't2': 1720461424, 'd': 1, 'uid': 6581,
 'c': ['12', 'Daf 01KG 541AE', '10.28 км', '0.00 л', '11.64 л', '0.00 л/100 км', '107.13 л/100 км', '0.00 л', '0.00 л']}
{'n': 12, 'i1': 0, 'i2': 12238, 't1': 1720405915, 't2': 1720461561, 'd': 1, 'uid': 6582,
 'c': ['13', 'Daf 01KG 0582M', '204.88 км', '0.00 л', '85.96 л', '0.00 л/100 км', '41.82 л/100 км', '0.00 л', '0.00 л']}
{'n': 13, 'i1': 0, 'i2': 1580, 't1': 1720409460, 't2': 1720457785, 'd': 1, 'uid': 6586,
 'c': ['14', 'Daf 01KG 743AE', '498.83 км', '0.00 л', '207.45 л', '0.00 л/100 км', '41.57 л/100 км', '288.51 л',
       '0.00 л']}
{'n': 14, 'i1': 0, 'i2': 899, 't1': 1720408245, 't2': 1720445312, 'd': 1, 'uid': 6578,
 'c': ['15', 'Daf 04KG 418AC', '91.23 км', '0.00 л', '58.01 л', '0.00 л/100 км', '63.53 л/100 км', '0.00 л', '0.00 л']}
{'n': 15, 'i1': 0, 'i2': 381, 't1': 1720375351, 't2': 1720461315, 'd': 1, 'uid': 6587,
 'c': ['16', 'Daf 04KG 422AC', '4.04 км', '0.00 л', '4.50 л', '0.00 л/100 км', '102.02 л/100 км', '0.00 л', '0.00 л']}
{'n': 16, 'i1': 0, 'i2': 287, 't1': 1720375304, 't2': 1720461557, 'd': 1, 'uid': 6635,
 'c': ['17', 'Daf 01KG 086AE', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 17, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6634,
 'c': ['18', 'Daf 01KG 123AE', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 18, 'i1': 0, 'i2': 621, 't1': 1720406810, 't2': 1720461319, 'd': 1, 'uid': 6566,
 'c': ['19', 'Daf 01KG 124AE', '10.88 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 19, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6706,
 'c': ['20', 'Daf 01KG 238AH проданred_realcom', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км',
       '0.00 л', '0.00 л']}
{'n': 20, 'i1': 0, 'i2': 1095, 't1': 1720399180, 't2': 1720461323, 'd': 1, 'uid': 6757,
 'c': ['21', 'Daf 01KG 273AE', '447.98 км', '0.00 л', '265.49 л', '0.00 л/100 км', '59.22 л/100 км', '296.40 л',
       '0.00 л']}
{'n': 21, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6608,
 'c': ['22', 'Daf 01KG 274AE', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 22, 'i1': 0, 'i2': 452, 't1': 1720430162, 't2': 1720461597, 'd': 1, 'uid': 6563,
 'c': ['23', 'Daf 01KG 275AE', '81.08 км', '0.00 л', '9.44 л', '0.00 л/100 км', '11.29 л/100 км', '0.00 л', '0.00 л']}
{'n': 23, 'i1': 0, 'i2': 2404, 't1': 1720402403, 't2': 1720457073, 'd': 1, 'uid': 6595,
 'c': ['24', 'Daf 01KG 276AE', '566.68 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 24, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6607,
 'c': ['25', 'Daf 01KG 325AE', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 25, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6705,
 'c': ['26', 'Daf 01KG 370AG', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 26, 'i1': 0, 'i2': 1473, 't1': 1720407307, 't2': 1720461579, 'd': 1, 'uid': 6585,
 'c': ['27', 'Daf 01KG 397AE', '110.07 км', '0.00 л', '96.52 л', '0.00 л/100 км', '87.10 л/100 км', '0.00 л', '0.00 л']}
{'n': 27, 'i1': 0, 'i2': 792, 't1': 1720407222, 't2': 1720461323, 'd': 1, 'uid': 6725,
 'c': ['28', 'Daf 01KG 405AF', '38.99 км', '0.00 л', '6.50 л', '0.00 л/100 км', '16.37 л/100 км', '0.00 л', '0.00 л']}
{'n': 28, 'i1': 0, 'i2': 855, 't1': 1720375367, 't2': 1720459550, 'd': 1, 'uid': 6352,
 'c': ['29', 'Daf 01KG 449AE', '43.88 км', '0.00 л', '25.88 л', '0.00 л/100 км', '58.20 л/100 км', '0.00 л', '0.00 л']}
{'n': 29, 'i1': 0, 'i2': 495, 't1': 1720413815, 't2': 1720461574, 'd': 1, 'uid': 6577,
 'c': ['30', 'Daf 01KG 450AE', '48.43 км', '0.00 л', '22.10 л', '0.00 л/100 км', '45.23 л/100 км', '0.00 л', '0.00 л']}
{'n': 30, 'i1': 0, 'i2': 263, 't1': 1720375452, 't2': 1720427117, 'd': 1, 'uid': 6567,
 'c': ['31', 'Daf 01KG 451AE', '0.22 км', '0.00 л', '3.06 л', '0.00 л/100 км', '1059.13 л/100 км', '0.00 л', '0.00 л']}
{'n': 31, 'i1': 0, 'i2': 241, 't1': 1720407631, 't2': 1720461352, 'd': 1, 'uid': 6571,
 'c': ['32', 'Daf 01KG 471AH', '0.00 км', '0.00 л', '3.46 л', '0.00 л/100 км', '416.09 л/100 км', '0.00 л', '0.00 л']}
{'n': 32, 'i1': 0, 'i2': 315, 't1': 1720375458, 't2': 1720461509, 'd': 1, 'uid': 6603,
 'c': ['33', 'Daf 01KG 474AE', '0.00 км', '0.00 л', '1.29 л', '0.00 л/100 км', '716.04 л/100 км', '0.00 л', '0.00 л']}
{'n': 33, 'i1': 0, 'i2': 491, 't1': 1720375314, 't2': 1720461500, 'd': 1, 'uid': 6593,
 'c': ['34', 'Daf 01KG 476AE', '13.47 км', '0.00 л', '8.91 л', '0.00 л/100 км', '63.33 л/100 км', '0.00 л', '0.00 л']}
{'n': 34, 'i1': 0, 'i2': 1371, 't1': 1720375390, 't2': 1720443263, 'd': 1, 'uid': 6663,
 'c': ['35', 'Daf 01KG 477AE', '409.05 км', '0.00 л', '139.50 л', '0.00 л/100 км', '34.08 л/100 км', '0.00 л',
       '0.00 л']}
{'n': 35, 'i1': 0, 'i2': 4645, 't1': 1720405378, 't2': 1720461557, 'd': 1, 'uid': 6568,
 'c': ['36', 'Daf 01KG 495AG', '121.86 км', '0.00 л', '50.20 л', '0.00 л/100 км', '41.14 л/100 км', '0.00 л', '0.00 л']}
{'n': 36, 'i1': 0, 'i2': 387, 't1': 1720375239, 't2': 1720461398, 'd': 1, 'uid': 6589,
 'c': ['37', 'Daf 01KG 0500M', '0.23 км', '0.00 л', '2.18 л', '0.00 л/100 км', '172.16 л/100 км', '0.00 л', '0.00 л']}
{'n': 37, 'i1': 0, 'i2': 443, 't1': 1720375413, 't2': 1720461593, 'd': 1, 'uid': 6583,
 'c': ['38', 'Daf 01KG 542AE', '0.58 км', '0.00 л', '3.66 л', '0.00 л/100 км', '340.20 л/100 км', '0.00 л', '0.00 л']}
{'n': 38, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6574,
 'c': ['39', 'Daf 01KG 543AE', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 39, 'i1': 0, 'i2': 388, 't1': 1720375488, 't2': 1720461399, 'd': 1, 'uid': 6590,
 'c': ['40', 'Daf 01KG 564AH', '0.14 км', '0.00 л', '1.43 л', '0.00 л/100 км', '256.12 л/100 км', '0.00 л', '0.00 л']}
{'n': 40, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6616,
 'c': ['41', 'Daf 01KG 603AH', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 41, 'i1': 0, 'i2': 2596, 't1': 1720375460, 't2': 1720461555, 'd': 1, 'uid': 6597,
 'c': ['42', 'Daf 01KG 612AG', '331.71 км', '0.00 л', '134.38 л', '0.00 л/100 км', '40.47 л/100 км', '0.00 л',
       '0.00 л']}
{'n': 42, 'i1': 0, 'i2': 1522, 't1': 1720375251, 't2': 1720461559, 'd': 1, 'uid': 6580,
 'c': ['43', 'Daf 01KG 625AE', '156.00 км', '0.00 л', '45.95 л', '0.00 л/100 км', '29.40 л/100 км', '0.00 л', '0.00 л']}
{'n': 43, 'i1': 0, 'i2': 0, 't1': 0, 't2': 0, 'd': 1, 'uid': 6750,
 'c': ['44', 'Daf 01KG 658AD ДТП red_realcom', '0.00 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км',
       '0.00 л', '0.00 л']}
{'n': 44, 'i1': 0, 'i2': 1726, 't1': 1720375422, 't2': 1720461588, 'd': 1, 'uid': 6662,
 'c': ['45', 'Daf 01KG 744AE', '434.57 км', '0.00 л', '170.28 л', '0.00 л/100 км', '39.17 л/100 км', '0.00 л',
       '0.00 л']}
{'n': 45, 'i1': 0, 'i2': 4050, 't1': 1720405390, 't2': 1720461530, 'd': 1, 'uid': 6646,
 'c': ['46', 'Daf 01KG 746AE', '193.26 км', '0.00 л', '120.16 л', '0.00 л/100 км', '62.10 л/100 км', '362.40 л',
       '0.00 л']}
{'n': 46, 'i1': 0, 'i2': 1878, 't1': 1720398797, 't2': 1720461439, 'd': 1, 'uid': 6584,
 'c': ['47', 'Daf 01KG 747AE', '412.57 км', '157.60 л', '182.21 л', '38.17 л/100 км', '44.13 л/100 км', '0.00 л',
       '0.00 л']}
{'n': 47, 'i1': 0, 'i2': 997, 't1': 1720422118, 't2': 1720461301, 'd': 1, 'uid': 6575,
 'c': ['48', 'Daf 01KG 748AE', '231.59 км', '82.00 л', '0.00 л', '35.38 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
{'n': 48, 'i1': 0, 'i2': 849, 't1': 1720403907, 't2': 1720453406, 'd': 1, 'uid': 6649,
 'c': ['49', 'Daf 01KG 749AE', '263.61 км', '0.00 л', '148.68 л', '0.00 л/100 км', '56.37 л/100 км', '0.00 л',
       '0.00 л']}
{'n': 49, 'i1': 0, 'i2': 36304, 't1': 1720375446, 't2': 1720461389, 'd': 1, 'uid': 6591,
 'c': ['50', 'Daf 01KG 795AC', '650.92 км', '0.00 л', '0.00 л', '0.00 л/100 км', '0.00 л/100 км', '0.00 л', '0.00 л']}
